<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: tcp/server.js</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: tcp/server.js</h1>

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>'use strict';

const net = require('net');

const port = 3333;
const server = net.createServer();

server.listen(port, ()=> console.log('server up on ', port));

let socketPool = {};
let allowedEvents = ['error', 'success'];

/**
 * When a socket connects to the server, give them an id and print it.
 * @param  {} 'connection'
 * @param  {} (socket
 * @param  {} =>{constid=`Socket-${Math.random(
 * @param  {} }`;socketPool[id]=socket;console.log(`Welcome`
 * @param  {} id
 * @param  {} ;socket.on('close'
 * @param  {} (
 * @param  {} =>{deletesocketPool[id];console.log(`Goodbye${id}`
 * @param  {} ;}
 * @param  {} ;socket.on('data'
 * @param  {} handleData
 * @param  {} ;}
 */
server.on('connection', (socket) => {

  const id = `Socket-${Math.random()}`;
  socketPool[id] = socket;
  console.log(`Welcome `, id);

  socket.on('close', () => {
    delete socketPool[id];
    console.log(`Goodbye ${id}`);
  });

  socket.on('data', handleData);

});

/**
 * Write to the console if an allowed event is recieved.
 * @param  {} buffer
 * @param  {} =>{lettext=buffer.toString(
 * @param  {} .trim(
 * @param  {} ;let[event
 * @param  {} payload]=text.split(/\s+(.*
 * @param  {} /
 * @param  {} ;if(allowedEvents.includes(event
 * @param  {} {console.log(`BROADCAST
 */
const handleData = (buffer) => {
  let text = buffer.toString().trim();
  let [event, payload] = text.split(/\s+(.*)/);

  if(allowedEvents.includes(event)) {
    console.log(`BROADCAST: ${event}`);
    for(let socket in socketPool) {
      socketPool[socket].write(`${event}: ${payload}\n`);
    }
  }
  else {
    console.log(`Ignore: ${event}`);
  }

  console.log('Event:', event, 'Payload:', payload);
};
</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Global</h3><ul><li><a href="global.html#alterFile">alterFile</a></li><li><a href="global.html#editBuffer">editBuffer</a></li><li><a href="global.html#handleData">handleData</a></li><li><a href="global.html#readIn">readIn</a></li><li><a href="global.html#writeOut">writeOut</a></li></ul>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.5.5</a> on Wed Apr 10 2019 07:30:10 GMT-0800 (GMT-08:00)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
